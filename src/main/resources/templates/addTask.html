<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Add Task</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function addUser() {
            const selectedUser = document.getElementById('userSelect');
            const selectedValue = selectedUser.value;
            const selectedText = selectedUser.options[selectedUser.selectedIndex].text;

            if (selectedValue && !document.getElementById('user-' + selectedValue)) {
                const userContainer = document.getElementById('selectedUsers');

                const userDiv = document.createElement('div');
                userDiv.id = 'user-' + selectedValue;
                userDiv.classList.add('d-flex', 'align-items-center', 'mb-2');

                const userText = document.createElement('span');
                userText.innerText = selectedText;
                userText.classList.add('me-3');

                const removeButton = document.createElement('button');
                removeButton.type = 'button';
                removeButton.classList.add('btn', 'btn-danger', 'btn-sm');
                removeButton.innerText = 'x';
                removeButton.onclick = () => {
                    userContainer.removeChild(userDiv);
                    const option = document.createElement('option');
                    option.value = selectedValue;
                    option.text = selectedText;
                    selectedUser.appendChild(option);
                };

                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = 'selectedUsers';
                hiddenInput.value = selectedValue;

                userDiv.appendChild(userText);
                userDiv.appendChild(removeButton);
                userDiv.appendChild(hiddenInput);

                userContainer.appendChild(userDiv);

                // Remove the selected option from the select box
                selectedUser.options[selectedUser.selectedIndex].remove();
            }

            selectedUser.value = ''; // Reset the select box
        }
    </script>
</head>
<body>
<div class="container mt-5">
    <h3>Add Task</h3>
    <form th:action="@{/task/create}" method="post" enctype="multipart/form-data" class="mt-4">
        <input type="hidden" th:value="${statusId}" name="statusId">
        <!-- Title -->
        <div class="mb-3">
            <label for="title" class="form-label">Title</label>
            <input type="text" id="title" name="title" class="form-control" placeholder="Enter task title" required>
        </div>

        <!-- Description -->
        <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea id="description" name="description" class="form-control" rows="3" placeholder="Enter task description" required></textarea>
        </div>

        <div class="mb-3">
            <label for="file" class="form-label">Task Image</label>
            <input type="file" id="file" name="file" class="form-control">
        </div>

        <div class="mb-3">
            <label for="userSelect" class="form-label">Assign Users</label>
            <select id="userSelect" class="form-select" onchange="addUser()">
                <option value="" disabled selected>Select a user</option>
                <option th:each="user : ${users}" th:value="${user.id}" th:text="${user.fullName}"></option>
            </select>
        </div>
        <div class="mb-3">
            <input type="date" name="deadline" class="form-control">
        </div>
        <div id="selectedUsers" class="mb-3"></div>
        <button type="submit" class="btn btn-primary">Add Task</button>
    </form>
</div>
</body>
</html>
